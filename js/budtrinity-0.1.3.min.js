(function(g){var y=false,k=false,d="/i",f=500,h=[],u=[],C=[],x=null,b=true,w,r;var v=true;g.init=function(E){if(!y){r=m();y=true;h=j("bt_queue")||[],E=E||{};g.debug=E.debug||g.debug||false;g.app_key=E.app_key||g.app_key||null;g.device_id=E.device_id||g.device_id||p();g.url=e(E.url||g.url||"https://101.230.192.75:47315");g.app_version=E.app_version||g.app_version||"0.0";g.country_code=E.country_code||g.country_code||null;g.city=E.city||g.city||null;g.ip_address=E.ip_address||g.ip_address||null;g.sdk_version=E.sdk_version||"0.1.3";g.u_id=E.u_id||g.u_id||null;g.channel=E.channel||g.channel||"0000000000";g.net=E.net||g.net||0;g.q=g.q||[];if(g.q.constructor!==Array){g.q=[]}D();j("bt_id",g.device_id);l("Trinity initialized")}};g.begin_session=function(F){if(!k){l("Session started");w=m();k=true;b=(F)?false:true;var E={};E.begin_session=1;E.metrics=JSON.stringify(B());z(E)}};g.session_duration=function(E){if(k){l("Session extended",E);z({session_duration:E})}};g.end_session=function(){if(k){l("Ending session");k=false;z({end_session:1,session_duration:m()-w})}};g.change_id=function(E){var F=g.device_id;g.device_id=E;j("bt_id",g.device_id);l("Changing id");z({old_device_id:F})};g.set_u_id=function(E){g.u_id=E;l("set_u_id")};g.clean_u_id=function(){g.u_id=null;l("clean_u_id")};g.add_event=function(F){if(!F.key){l("Event must have key property");return}if(!F.count){F.count=1}var E=["key","count","sum","segmentation"];u.push(s(F,E));l("Adding event: ",F)};g.user_details=function(E){l("Adding userdetails: ",E);var F=["name","username","email","organization","phone","picture","gender","byear","custom"];z({user_details:JSON.stringify(s(E,F))})};g.track_errors=function(E){x=E;window.onerror=function(M,J,G,I,K){if(K){q(K,false)}else{I=I||(window.event&&window.event.errorCharacter);var H="";if(M){H+=M+"\n"}if(J){H+="at "+J}if(G){H+=":"+G}if(I){H+=":"+I}H+="\n";try{var F=[];var L=arguments.callee.caller;while(L){F.push(L.name);L=L.caller}H+=F.join("\n")}catch(K){}q(H,false)}}};g.log_error=function(E){q(E,true)};g.add_log=function(E){C.push(E)};g.track_sessions=function(){g.begin_session();o(window,"beforeunload",function(){g.end_session()});o(window,"unload",function(){g.end_session()});var F="hidden";function E(){if(document[F]){g.end_session()}else{g.begin_session()}}if(F in document){document.addEventListener("visibilitychange",E)}else{if((F="mozHidden") in document){document.addEventListener("mozvisibilitychange",E)}else{if((F="webkitHidden") in document){document.addEventListener("webkitvisibilitychange",E)}else{if((F="msHidden") in document){document.addEventListener("msvisibilitychange",E)}else{if("onfocusin" in document){o(window,"focusin",function(){g.begin_session()});o(window,"focusout",function(){g.end_session()})}else{o(window,"focus",function(){g.begin_session()});o(window,"blur",function(){g.end_session()});o(window,"pageshow",function(){g.begin_session()});o(window,"pagehide",function(){g.end_session()})}}}}}};g.track_pageview=function(){g.add_event({key:"page_view",segmentation:{host:window.location.host,path:window.location.pathname,protocol:window.location.protocol,hash:window.location.hash,query:window.location.search,url:window.location.href}})};g.track_clicks=function(E){E=E||document;function F(){if(E.getElementsByTagName){var G=E.getElementsByTagName("a");for(var H=0;H<G.length;H++){o(G[H],"click",function(J){var I=n(J);a(J);g.add_event({key:"link_click",segmentation:{href:I.href,text:I.innerText,id:I.id,x:J.pageX,y:J.pageY}});if(I.href&&I.target!=="_blank"&&!(J.metaKey||J.altKey||J.ctrlKey||J.shiftKey)){g.end_session();A(J);setTimeout(function(){window.location.href=I.href},1000)}})}}else{l("Can't track clicks")}}if(document.readyState==="complete"){F()}else{o(window,"load",F)}};g.track_forms=function(F){F=F||document;function E(I){return I.name||I.id||I.type||I.nodeName}function H(J){var I=false;o(J,"submit",function(P){if(!I){I=true;var M={id:J.id,name:J.name,action:J.action,method:J.method};var L;if(J.elements){for(var O=0;O<J.elements.length;O++){L=J.elements[O];if(L.nodeName.toLowerCase()=="select"){if(L.multiple){var K=[];if(L.options){for(var N=0;N<L.options.length;N++){if(L.options[N].selected){K.push(L.options[N].value)}}}M["input:"+E(L)]=K.join()}else{M["input:"+E(L)]=L.options[L.selectedIndex].value}}else{if(L.nodeName.toLowerCase()=="input"){if(L.type){if(L.type.toLowerCase()=="checkbox"||L.type.toLowerCase()=="radio"){if(L.checked){M["input:"+E(L)]=L.value}}else{M["input:"+E(L)]=L.value}}else{M["input:"+E(L)]=L.value}}else{if(L.nodeName.toLowerCase()=="textarea"){M["input:"+E(L)]=L.value}else{if(L.value){M["input:"+E(L)]=L.value}}}}}}g.add_event({key:"form_submit",segmentation:M});g.end_session();A(P);setTimeout(function(){J.submit()},1000)}})}function G(){if(F.getElementsByTagName){var I=F.getElementsByTagName("form");for(var J=0;J<I.length;J++){H(I[J])}}else{l("Can't track forms")}}if(document.readyState==="complete"){G()}else{o(window,"load",G)}};function z(E){if(!g.app_key||!g.device_id){l("app_key or device_id is missing");return}E.app_key=g.app_key;E.device_id=g.device_id;E.channel=g.channel;E.net=g.net;E.app_version=g.app_version;E.sdk_version=g.sdk_version;if(g.u_id){E.u_id=g.u_id}if(g.country_code){E.country_code=g.country_code}if(g.city){E.city=g.city}if(g.ip_address){E.ip_address=g.ip_address}E.timestamp=m();h.push(E);j("bt_queue",h,true)}function D(){if(g.q&&g.q.length>0){var H;for(var F=0;F<g.q.length;F++){H=g.q[F];if(H.constructor===Array&&H.length>0){l("Processing queued call",H);if(g[H[0]]){g[H[0]](H[1])}}}g.q=[]}if(k&&b&&v){var G=m();if(G-w>60){g.session_duration(G-w);w=G}}if(u.length>0){if(u.length<=10){z({events:JSON.stringify(u)});u=[]}else{var E=u.splice(0,10);z({events:JSON.stringify(u)})}}if(h.length>0){var I=h.shift();l("Processing request",I);i(I,function(J,K){l("Request Finished",K,false);if(J){h.unshift(K);j("bt_queue",h,true)}});j("bt_queue",h,true)}setTimeout(D,f)}function p(){var E=j("bt_id")||c();j("bt_id",E);return E}function c(){var F=new Date().getTime();var E="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(H){var G=(F+Math.random()*16)%16|0;F=Math.floor(F/16);return(H=="x"?G:(G&3|8)).toString(16)});return E}function B(){var O={};O._app_version=g.app_version;if(screen.width){var F=(screen.width)?screen.width:"";var R=(screen.height)?screen.height:"";O._resolution=""+F+"x"+R}var Q=navigator.appVersion;var L=navigator.userAgent;var J=navigator.appName;var M=""+parseFloat(navigator.appVersion);var S,G;if(L.indexOf("Opera")!=-1){J="Opera"}else{if(L.indexOf("MSIE")!=-1){J="Internet Explorer"}else{if(L.indexOf("Chrome")!=-1){J="Chrome"}else{if(L.indexOf("Safari")!=-1){J="Safari"}else{if(L.indexOf("Firefox")!=-1){J="Firefox"}else{if(L.indexOf("Trident/")!=-1){J="Internet Explorer"}else{if((S=L.lastIndexOf(" ")+1)<(G=L.lastIndexOf("/"))){J=L.substring(S,G);if(J.toLowerCase()==J.toUpperCase()){J=navigator.appName}}}}}}}}O._carrier=J;var H="unknown";var N=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OSX",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"SearchBot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var E in N){var K=N[E];if(K.r.test(L)){H=K.s;break}}var I="unknown";if(/Windows/.test(H)){I=/Windows (.*)/.exec(H)[1];H="Windows"}switch(H){case"Mac OSX":I=/Mac OS X (10[\.\_\d]+)/.exec(L)[1];break;case"Android":I=/Android ([\.\_\d]+)/.exec(L)[1];break;case"iOS":I=/OS (\d+)_(\d+)_?(\d+)?/.exec(Q);I=I[1]+"."+I[2]+"."+(I[3]|0);break}O._os=H;O._os_version=I;var P=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;if(P){O._locale=P}l("Got metrics",O);return O}function l(){if(g.debug&&console){console.log(Array.prototype.slice.call(arguments))}}function m(){return Math.floor(new Date().getTime()/1000)}function q(J,K){var H="";if(typeof J==="object"){if(J.stack){H=J.stack}else{if(J.name){H+=J.name+":"}if(J.message){H+=J.message+"\n"}if(J.fileName){H+="in "+J.fileName+"\n"}if(J.lineNumber){H+="on "+J.lineNumber}if(J.columnNumber){H+=":"+J.columnNumber}}}else{H=J+""}K=(K)?true:false;var I=B();var F={_os:I._os,_os_version:I._os_version,_resolution:I._resolution,_error:H,_app_version:I._app_version,_manufacture:I._carrier,_run:m()-r};var E=navigator.battery||navigator.webkitBattery||navigator.mozBattery||navigator.msBattery;if(E){F._bat=Math.floor(E.level*100)}if(typeof navigator.onLine!=="undefined"){F._online=(navigator.onLine)?true:false}if(document.hasFocus){F._background=(document.hasFocus())?false:true}if(C.length>0){F._logs=C.join("\n")}F._nonfatal=K;if(x){F._custom=x}try{var G=document.createElement("canvas");gl=G.getContext("experimental-webgl");F._opengl=gl.getParameter(gl.VERSION)}catch(J){}z({crash:JSON.stringify(F)})}function i(G,H){try{l("Sending XML HTTP request");var F=window.XMLHttpRequest?new window.XMLHttpRequest():window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null;F.open("GET",g.url+d+"?"+t(G),true);F.send()}catch(E){l("Failed XML HTTP request",E);if(typeof H==="function"){H(true,G)}}}function t(G){var F=[];for(var E in G){F.push(E+"="+encodeURIComponent(G[E]))}return F.join("&")}function e(E){if(E.substr(E.length-1)=="/"){return E.substr(0,E.length-1)}return E}function s(I,G){var E={};var H;for(var F=0;F<G.length;F++){H=G[F];if(I[H]){E[H]=I[H]}}return E}var o=function(E,F,G){if(E.addEventListener){E.addEventListener(F,G,false)}else{E.attachEvent("on"+F,G)}};var n=function(E){if(!E){return window.event.srcElement}else{if(E.target){return E.target}else{return E.srcElement}}};var A=function(E){if(window.event){window.event.returnValue=false}else{if(E.preventDefault){E.preventDefault()}else{E.returnValue=false}}};function a(E){if(typeof E.pageY=="undefined"&&typeof E.clientX=="number"&&document.documentElement){E.pageX=E.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;E.pageY=E.clientY+document.body.scrollTop+document.documentElement.scrollTop}return E}var j=function j(G,J,F){var H=false,I;if(localStorage){H=true}if(typeof J!=="undefined"&&J!==null){if(typeof J==="object"){J=JSON.stringify(J)}if(H){localStorage.setItem(G,J)}else{if(!F){E(G,J,30)}}}if(typeof J==="undefined"){if(H){I=localStorage.getItem(G)}else{if(!F){I=K(G)}}try{I=JSON.parse(I)}catch(L){I=I}return I}if(J===null){if(H){localStorage.removeItem(G)}else{if(!F){E(G,"",-1)}}}function E(O,P,Q){var N=new Date();N.setTime(N.getTime()+(Q*24*60*60*1000));var M="; expires="+N.toGMTString();document.cookie=O+"="+P+M+"; path=/"}function K(P){var Q=P+"=";var N=document.cookie.split(";");for(var O=0,M=N.length;O<M;O++){var R=N[O];while(R.charAt(0)===" "){R=R.substring(1,R.length)}if(R.indexOf(Q)===0){return R.substring(Q.length,R.length)}}return null}}}(window.Trinity=window.Trinity||{}));